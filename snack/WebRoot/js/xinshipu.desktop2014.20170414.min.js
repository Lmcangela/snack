function mopen(e){mcancelclosetime(),ddmenuitem&&(ddmenuitem.style.visibility="hidden"),ddmenuitem=document.getElementById(e),ddmenuitem.style.visibility="visible"}function mclose(){ddmenuitem&&(ddmenuitem.style.visibility="hidden")}function mclosetime(){closetimer=window.setTimeout(mclose,timeout)}function mcancelclosetime(){closetimer&&(window.clearTimeout(closetimer),closetimer=null)}jQuery.cookie=function(e,t,n){if("undefined"==typeof t){var o=null;if(document.cookie&&""!=document.cookie)for(var i=document.cookie.split(";"),a=0;a<i.length;a++){var s=jQuery.trim(i[a]);if(s.substring(0,e.length+1)==e+"="){o=decodeURIComponent(s.substring(e.length+1));break}}return o}n=n||{},null===t&&(t="",n.expires=-1);var l="";if(n.expires&&("number"==typeof n.expires||n.expires.toUTCString)){var r;"number"==typeof n.expires?(r=new Date,r.setTime(r.getTime()+24*n.expires*60*60*1e3)):r=n.expires,l="; expires="+r.toUTCString()}var c=n.path?"; path="+n.path:"",d=n.domain?"; domain="+n.domain:"",m=n.secure?"; secure":"";document.cookie=[e,"=",encodeURIComponent(t),l,c,d,m].join("")},function(e){e.extend({noticeAdd:function(t){var t,n,o,i,a,s={inEffect:{opacity:"show"},inEffectDuration:600,stayTime:3e3,text:"",stay:!1,type:"notice"};t=e.extend({},s,t),n=e(".notice-wrap").length?e(".notice-wrap"):e("<div></div>").addClass("notice-wrap").appendTo("body"),o=e("<div></div>").addClass("notice-item-wrapper"),i=e("<div></div>").hide().addClass("notice-item "+t.type).appendTo(n).html("<p>"+t.text+"</p>").animate(t.inEffect,t.inEffectDuration).wrap(o),a=e("<div></div>").addClass("notice-item-close").prependTo(i).html("x").click(function(){e.noticeRemove(i)}),navigator.userAgent.match(/MSIE 6/i)&&n.css({top:document.documentElement.scrollTop}),t.stay||setTimeout(function(){e.noticeRemove(i)},t.stayTime)},noticeRemove:function(e){e.animate({opacity:"0"},600,function(){e.parent().animate({height:"0px"},300,function(){e.parent().remove()})})}}),$.fn.extend({tagEditor:function(t,n){var o,i,a={separator:",",items:[],className:"tagEditor",confirmRemoval:!1,confirmRemovalText:"Do you really want to remove the tag?",completeOnSeparator:!1,completeOnBlur:!1,initialParse:!0},t=$.extend(a,t),s=this,l=[];return this.getTags=function(){return l.join(t.separator)},this.each(function(){function a(n){n=e.trim(n);for(var i=0;i<l.length;i++)if(l[i].toLowerCase()==n.toLowerCase())return;var a=$(document.createElement("span"));a.text(n),a.attr("title","ÂéªÈô§ÂàÜÁ±ª"),a.attr("class","type-tag"),a.click(function(){(!t.confirmRemoval||confirm(t.confirmRemovalText))&&(a.remove(),c())}),o.append(a)}function r(){l=[];for(var t=$("span",o),n=0;n<t.length;n++)l.push(e.trim($(t[n]).text()))}function c(){for(var n=s.val().split(t.separator),o=0;o<n.length;o++){var i=e.trim(n[o]);i.length>0&&a(i)}s.val(""),r()}function d(n){var o=n.which?n.which:n.keyCode;if(t.completeOnSeparator&&String.fromCharCode(o)==t.separator)return c(),!1;switch(o){case 13:return""!=e.trim(s.val())?(c(),!1):!0}}i=$(document.createElement("input")),i.attr("type","hidden"),s.after(i),o=$(document.createElement("ul")),o.attr("class",t.className+" dd mt10"),$(this).after(o);for(var m=0;m<t.items.length;m++)a(e.trim(t.items[m]));t.initialParse&&c(),t.completeOnBlur&&$(this).blur(c),r(),$(this).keypress(d);var u=$(this).parents("form");u.submit(function(){c(),i.val(l.join(t.separator)),i.attr("id",s.attr("id")),i.attr("name",s.attr("name")),s.attr("id",s.attr("id")+"_old"),s.attr("name",s.attr("name")+"_old")}),n.click(function(){s.attr("value",$(this).text()),c()})})}})}(jQuery),function(e){e.fn.extend({elastic:function(){return this.each(function(){function t(){var e,t,i=$(n);e||(e=i.clone().css({position:"absolute",top:"-9999px",left:"-9999px",width:i.width()}).appendTo("body")),i.css("overflow","hidden"),t=e.val(i.val()).height(0).scrollTop(999).scrollTop(),i.css("height",Math.max(t+7,o))}var n=this;if("textarea"!==n.type)return!1;var o=$(n).height();t(),e(this).keyup(t)})}})}(jQuery),window.openLogin=function(e,t,n){var o=$("#login");null==o.html()&&(o=$("<div id='login'  title='登录心食谱'></div>").insertAfter("#hd"));var i=e;""!=t&&(e=e+"?action="+t),ga("send","event","loginPopup","action"),$(o).load("/desktop2014/inc/loginPopup.html",function(){$("#loginMessage").html(n),$("#emailoverlay").keyup(function(e){}),$("#passwordoverlay").keyup(function(e){}),$("#emailoverlay").focus(),$("#login").dialog({height:470,width:860,modal:!0,resizable:!1,buttons:{"登录":function(){ga("send","event","loginPopup","login");var t=$("#emailoverlay").val();return""==t?($("#loginMessage").html("Email或用户名不能为空"),!1):void $.post("/api/doAjaxLogin.html",{email:$("#emailoverlay").val(),password:$("#passwordoverlay").val(),captcha:$("#captcha").val()},function(t){-1!=t.search(/newEmail/i)?$("#loginMessage").html('这个email地址还没有注册过，<a target="_self" href="/registration.html?from='+e+"&newemail="+$("#emailoverlay").val()+'" style="text-decoration:underline;">立即注册</a>'):-1!=t.search(/wronglogin/i)?$("#loginMessage").html('密码错误。<a target="_self" href="/forgetpassword.html" style="text-decoration:underline;">忘记密码</a>'):-1!=t.search(/notName/i)?$("#loginMessage").html('这个用户名还没有注册过，<a target="_self" href="/registration.html?from='+e+'" style="text-decoration:underline;">立即注册</a>'):-1!=t.search(/wrongcaptcha/i)?($("#loginMessage").html("验证码错误"),$("#captchaLabel").html('<label class="cg2">输入验证码</label><i class="icon-font icon-lock cg2 font16"></i><input type="text" class="text" name="captcha" id="captcha"/>&nbsp;<img id="captchaimg" src="/captcha/" height="32" class="mt20" title="" />'),$("#captchaLabel").show()):-1!=t.search(/captcha/i)?($("#loginMessage").html("密码错误"),$("#captchaLabel").html('<label class="cg2">输入验证码</label><i class="icon-font icon-lock cg2 font16"></i><input type="text" class="text" name="captcha" id="captcha"/>&nbsp;<img id="captchaimg" src="/captcha/" height="32" class="mt20" title="" />'),$("#captchaLabel").show()):-1!=t.search(/success/i)?window.location=i:($("#loginMessage").html('密码错误。<a target="_self" href="/forgetpassword.html" style="text-decoration:underline;">忘记密码</a>'),$("#loginMessage").show())})},"注册":function(){window.location=$("#refererURL").val()}}}),$(this).keyup(function(e){return 13==e.keyCode?($(".ui-dialog-buttonset").find("button:first").click(),!1):void 0})})},window.isUserLogon=function(){return""==$("#userid").val()?!1:!0},window.isUserRegisted=function(){return null!=$.cookie("SESSION_LOGIN_USEREMAIL")?!0:!1},window.loadCss=function(e){var t=document.getElementById("loadCss"),n=document.getElementsByTagName("head").item(0);t&&n.removeChild(t),css=document.createElement("link"),css.href=e,css.rel="stylesheet",css.type="text/css",css.id="loadCss",n.appendChild(css)},window.init=function(e){$("#q").autocomplete({minLength:0,source:"/doGetSuggestion.html",select:function(e,t){window.location="/doSearch.html?q="+t.item.value}}).click(function(){$(this).autocomplete("search","")}),e||(e=""),$("a").mouseup(function(){void 0!=$(this).attr("rel")&&ga("send","event",e,$(this).attr("rel"),$(this).html())});var t=$(".paging ul").width();null!=t&&$(".paging > .clearfix").css("width",t+163)},window.delGuanZhu=function(e){return isUserLogon()?$.post("/api/doGuanZhu.html",{userid:e,type:"del"},function(t){var n="<div id='guanzhu"+e+"'><a href='javascript:void(0);' onclick='addGuanZhu("+e+");'  class='add-focus ingredient'><i class='icon-plus'></i><span class='ml10'>关注</span></a></div>";$("#guanzhu"+e).replaceWith(n);var o="<span id='follower"+e+"'><a href='javascript:void(0);' onclick='addGuanZhu("+e+");'  class='col fr'><i class='icon-plus'></i><span class='ml10'>关注</span></a></span>";$("#follower"+e).replaceWith(o)}):openLogin(window.location.pathname,"chufang",""),!1},window.delEvent=function(){return isUserLogon()?$.post("/api/doDelEvent.html",function(e){window.location.reload()}):openLogin(window.location.pathname,"",""),!1},window.addGuanZhu=function(e){return isUserLogon()?$.post("/api/doGuanZhu.html",{userid:e,type:"add"},function(t){var n="<div id='guanzhu"+e+"'><a id='follow' href='javascript:void(0);' onclick='delGuanZhu("+e+");' class='follow-icon onfollow havefollow focused' data='unfollow' _rel='havefollow'><i class='icon-ok cg2'></i><strong class='cg1 fontwn ml8'>已关注</strong></a></div>";$("#guanzhu"+e).replaceWith(n);var o="<span id='follower"+e+"'><a id='follow' href='javascript:void(0);' onclick='delGuanZhu("+e+");' class='fr follow-icon onfollow havefollow' data='unfollow' _rel='havefollow'><i class='icon-ok cg2'></i><strong class='cg1 fontwn ml8'>已关注</strong></a></span>";$("#follower"+e).replaceWith(o)}):openLogin(window.location.pathname,"chufang",""),!1},window.sendMessage=function(e){isUserLogon()?openMessageTagging(e):openLogin(window.location.pathname,"chufang","")},window.getIpAddr=function(e){$.post("/api/getIpInfo.html",function(e){$("#anonymousName").val(e)})},window.openMessageTagging=function(e){$("#tagging").dialog({height:450,width:700,modal:!0,resizable:!1,buttons:{"确定":function(){$("#tagging").hide("slow"),$.post("/api/doAddmessage.html",{content:$("#content").val(),userid:e},function(e){jQuery.noticeAdd({text:"发送成功",stay:!1})}),$(this).dialog("close"),$(this).hide()},"取消":function(){$(this).dialog("close")}}})},function(e){e.fn.extend({jqEasyCounter:function(t){return this.each(function(){function n(){var e=o.val(),t=e.length;if(t>=i.maxChars&&(e=e.substring(0,i.maxChars)),t>i.maxChars){var n=o.scrollTop();o.val(e.substring(0,i.maxChars)),o.scrollTop(n)}t>=i.maxCharsWarning?a.css({color:i.msgWarningColor}):a.css({color:i.msgFontColor}),a.html(o.val().length+"/"+i.maxChars),a.stop().fadeTo("fast",1)}var o=e(this),i=e.extend({maxChars:100,maxCharsWarning:80,msgFontSize:"12px",msgFontColor:"#000000",msgFontFamily:"Arial",msgTextAlign:"right",msgWarningColor:"#F00",msgAppendMethod:"insertAfter"},t);if(!(i.maxChars<=0)){var a=e('<div class="jqEasyCounterMsg">&nbsp;</div>'),s={"font-size":i.msgFontSize,"font-family":i.msgFontFamily,color:i.msgFontColor,"text-align":i.msgTextAlign,width:o.width(),opacity:0};a.css(s),a[i.msgAppendMethod](o),o.bind("keydown keyup keypress",n).bind("focus paste",function(){setTimeout(n,10)}).bind("blur",function(){return a.stop().fadeTo("fast",0),!1})}})}})}(jQuery);var timeout=500,closetimer=0,ddmenuitem=0;document.onclick=mclose;