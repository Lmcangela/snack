jQuery.cookie=function(b,j,m){if(typeof j!="undefined"){m=m||{};if(j===null){j="";m.expires=-1}var e="";if(m.expires&&(typeof m.expires=="number"||m.expires.toUTCString)){var f;if(typeof m.expires=="number"){f=new Date();f.setTime(f.getTime()+(m.expires*24*60*60*1000))}else{f=m.expires}e="; expires="+f.toUTCString()}var l=m.path?"; path="+(m.path):"";var g=m.domain?"; domain="+(m.domain):"";var a=m.secure?"; secure":"";document.cookie=[b,"=",encodeURIComponent(j),e,l,g,a].join("")}else{var d=null;if(document.cookie&&document.cookie!=""){var k=document.cookie.split(";");for(var h=0;h<k.length;h++){var c=jQuery.trim(k[h]);if(c.substring(0,b.length+1)==(b+"=")){d=decodeURIComponent(c.substring(b.length+1));break}}}return d}};(function(a){a.extend({noticeAdd:function(c){var f={inEffect:{opacity:"show"},inEffectDuration:600,stayTime:3000,text:"",stay:false,type:"notice"};var c,g,e,d,b;c=a.extend({},f,c);g=(!a(".notice-wrap").length)?a("<div></div>").addClass("notice-wrap").appendTo("body"):a(".notice-wrap");e=a("<div></div>").addClass("notice-item-wrapper");d=a("<div></div>").hide().addClass("notice-item "+c.type).appendTo(g).html("<p>"+c.text+"</p>").animate(c.inEffect,c.inEffectDuration).wrap(e);b=a("<div></div>").addClass("notice-item-close").prependTo(d).html("x").click(function(){a.noticeRemove(d)});if(navigator.userAgent.match(/MSIE 6/i)){g.css({top:document.documentElement.scrollTop})}if(!c.stay){setTimeout(function(){a.noticeRemove(d)},c.stayTime)}},noticeRemove:function(b){b.animate({opacity:"0"},600,function(){b.parent().animate({height:"0px"},300,function(){b.parent().remove()})})}});$.fn.extend({tagEditor:function(c,d){var f={separator:",",items:[],className:"tagEditor",confirmRemoval:false,confirmRemovalText:"Do you really want to remove the tag?",completeOnSeparator:false,completeOnBlur:false,initialParse:true};var c=$.extend(f,c);var e,h=this,g;var b=[];this.getTags=function(){return b.join(c.separator)};return this.each(function(){g=$(document.createElement("input"));g.attr("type","hidden");h.after(g);e=$(document.createElement("ul"));e.attr("class",c.className+" dd mt10");$(this).after(e);for(var l=0;l<c.items.length;l++){k(a.trim(c.items[l]))}if(c.initialParse){o()}if(c.completeOnBlur){$(this).blur(o)}n();$(this).keypress(j);var m=$(this).parents("form");m.submit(function(){o();g.val(b.join(c.separator));g.attr("id",h.attr("id"));g.attr("name",h.attr("name"));h.attr("id",h.attr("id")+"_old");h.attr("name",h.attr("name")+"_old")});function k(p){p=a.trim(p);for(var q=0;q<b.length;q++){if(b[q].toLowerCase()==p.toLowerCase()){return}}var r=$(document.createElement("span"));r.text(p);r.attr("title","ÂéªÈô§ÂàÜÁ±ª");r.attr("class","type-tag");r.click(function(){if(c.confirmRemoval){if(!confirm(c.confirmRemovalText)){return}}r.remove();o()});e.append(r)}function n(){b=[];var p=$("span",e);for(var q=0;q<p.length;q++){b.push(a.trim($(p[q]).text()))}}function o(){var q=h.val().split(c.separator);for(var r=0;r<q.length;r++){var p=a.trim(q[r]);if(p.length>0){k(p)}}h.val("");n()}function j(i){var p=(i.which)?i.which:i.keyCode;if(c.completeOnSeparator){if(String.fromCharCode(p)==c.separator){o();return false}}switch(p){case 13:if(a.trim(h.val())!=""){o();return false}return true}}d.click(function(){h.attr("value",$(this).text());o()})})}})})(jQuery);(function(b){b.fn.extend({elastic:function(){return this.each(function(){var e=this;if(e.type!=="textarea"){return false}var a=$(e).height();function f(){var d=$(e),c,h;if(!c){c=d.clone().css({position:"absolute",top:"-9999px",left:"-9999px",width:d.width()}).appendTo("body")}d.css("overflow","hidden");h=c.val(d.val()).height(0).scrollTop(999).scrollTop();d.css("height",Math.max(h+7,a))}f();b(this).keyup(f)})}})})(jQuery);window.openLogin=function(e,d,c){var b=$("#login");if(b.html()==null){b=$("<div id='login'  title='登录心食谱'></div>").insertAfter("#hd")}var a=e;if(d!=""){e=e+"?action="+d}ga("send","event","loginPopup","action");$(b).load("/desktop2014/inc/loginPopup.html",function(){$("#loginMessage").html(c);$("#emailoverlay").keyup(function(f){});$("#passwordoverlay").keyup(function(f){});$("#emailoverlay").focus();$("#login").dialog({height:470,width:860,modal:true,resizable:false,buttons:{"登录":function(){ga("send","event","loginPopup","login");var f=$("#emailoverlay").val();if(f==""){$("#loginMessage").html("Email或用户名不能为空");return false}$.post("/api/doAjaxLogin.html",{email:$("#emailoverlay").val(),password:$("#passwordoverlay").val(),captcha:$("#captcha").val()},function(g){if(g.search(/newEmail/i)!=-1){$("#loginMessage").html('这个email地址还没有注册过，<a target="_self" href="/registration.html?from='+e+"&newemail="+$("#emailoverlay").val()+'" style="text-decoration:underline;">立即注册</a>')}else{if(g.search(/wronglogin/i)!=-1){$("#loginMessage").html('密码错误。<a target="_self" href="/forgetpassword.html" style="text-decoration:underline;">忘记密码</a>')}else{if(g.search(/notName/i)!=-1){$("#loginMessage").html('这个用户名还没有注册过，<a target="_self" href="/registration.html?from='+e+'" style="text-decoration:underline;">立即注册</a>')}else{if(g.search(/wrongcaptcha/i)!=-1){$("#loginMessage").html("验证码错误");$("#captchaLabel").html('<label class="cg2">输入验证码</label><i class="icon-font icon-lock cg2 font16"></i><input type="text" class="text" name="captcha" id="captcha"/>&nbsp;<img id="captchaimg" src="/captcha/" height="32" class="mt20" title="" />');$("#captchaLabel").show()}else{if(g.search(/captcha/i)!=-1){$("#loginMessage").html("密码错误");$("#captchaLabel").html('<label class="cg2">输入验证码</label><i class="icon-font icon-lock cg2 font16"></i><input type="text" class="text" name="captcha" id="captcha"/>&nbsp;<img id="captchaimg" src="/captcha/" height="32" class="mt20" title="" />');$("#captchaLabel").show()}else{if(g.search(/success/i)!=-1){window.location=a}else{$("#loginMessage").html('密码错误。<a target="_self" href="/forgetpassword.html" style="text-decoration:underline;">忘记密码</a>');$("#loginMessage").show()}}}}}}})},"注册":function(){window.location=$("#refererURL").val()}}});$(this).keyup(function(f){if(f.keyCode==13){$(".ui-dialog-buttonset").find("button:first").click();return false}})})};window.isUserLogon=function(){if($("#userid").val()==""){return false}else{return true}};window.isUserRegisted=function(){if($.cookie("SESSION_LOGIN_USEREMAIL")!=null){return true}else{return false}};window.loadCss=function(c){var a=document.getElementById("loadCss");var b=document.getElementsByTagName("head").item(0);if(a){b.removeChild(a)}css=document.createElement("link");css.href=c;css.rel="stylesheet";css.type="text/css";css.id="loadCss";b.appendChild(css)};window.init=function(b){loadCss("http://xinshipu.cn/css/ui-lightness-1.10.0/jquery-ui-1.10.0.custom.min.css");$("#q").autocomplete({minLength:0,source:"/doGetSuggestion.html",select:function(c,d){window.location="/doSearch.html?q="+d.item.value}}).click(function(){$(this).autocomplete("search","")});if(!b){b=""}$("a").mouseup(function(){if($(this).attr("rel")!=undefined){ga("send","event",b,$(this).attr("rel"),$(this).html())}});var a=$(".paging ul").width();if(a!=null){$(".paging > .clearfix").css("width",a+163)}};window.delGuanZhu=function(a){if(isUserLogon()){$.post("/api/doGuanZhu.html",{userid:a,type:"del"},function(d){var c="<div id='guanzhu"+a+"'><a href='javascript:void(0);' onclick='addGuanZhu("+a+");'  class='add-focus ingredient'><i class='icon-plus'></i><span class='ml10'>关注</span></a></div>";$("#guanzhu"+a).replaceWith(c);var b="<span id='follower"+a+"'><a href='javascript:void(0);' onclick='addGuanZhu("+a+");'  class='col fr'><i class='icon-plus'></i><span class='ml10'>关注</span></a></span>";$("#follower"+a).replaceWith(b)})}else{openLogin(window.location.pathname,"chufang","")}return false};window.delEvent=function(){if(isUserLogon()){$.post("/api/doDelEvent.html",function(a){window.location.reload()})}else{openLogin(window.location.pathname,"","")}return false};window.addGuanZhu=function(a){if(isUserLogon()){$.post("/api/doGuanZhu.html",{userid:a,type:"add"},function(d){var c="<div id='guanzhu"+a+"'><a id='follow' href='javascript:void(0);' onclick='delGuanZhu("+a+");' class='follow-icon onfollow havefollow focused' data='unfollow' _rel='havefollow'><i class='icon-ok cg2'></i><strong class='cg1 fontwn ml8'>已关注</strong></a></div>";$("#guanzhu"+a).replaceWith(c);var b="<span id='follower"+a+"'><a id='follow' href='javascript:void(0);' onclick='delGuanZhu("+a+");' class='fr follow-icon onfollow havefollow' data='unfollow' _rel='havefollow'><i class='icon-ok cg2'></i><strong class='cg1 fontwn ml8'>已关注</strong></a></span>";$("#follower"+a).replaceWith(b)})}else{openLogin(window.location.pathname,"chufang","")}return false};window.sendMessage=function(a){if(isUserLogon()){openMessageTagging(a)}else{openLogin(window.location.pathname,"chufang","")}};window.getIpAddr=function(a){$.post("/api/getIpInfo.html",function(b){$("#anonymousName").val(b)})};window.openMessageTagging=function(a){$("#tagging").dialog({height:450,width:700,modal:true,resizable:false,buttons:{"确定":function(){$("#tagging").hide("slow");$.post("/api/doAddmessage.html",{content:$("#content").val(),userid:a},function(b){jQuery.noticeAdd({text:"发送成功",stay:false})});$(this).dialog("close");$(this).hide()},"取消":function(){$(this).dialog("close")}}})};(function(a){a.fn.extend({jqEasyCounter:function(b){return this.each(function(){var f=a(this),e=a.extend({maxChars:100,maxCharsWarning:80,msgFontSize:"12px",msgFontColor:"#000000",msgFontFamily:"Arial",msgTextAlign:"right",msgWarningColor:"#F00",msgAppendMethod:"insertAfter"},b);if(e.maxChars<=0){return}var d=a('<div class="jqEasyCounterMsg">&nbsp;</div>');var c={"font-size":e.msgFontSize,"font-family":e.msgFontFamily,color:e.msgFontColor,"text-align":e.msgTextAlign,width:f.width(),opacity:0};d.css(c);d[e.msgAppendMethod](f);f.bind("keydown keyup keypress",g).bind("focus paste",function(){setTimeout(g,10)}).bind("blur",function(){d.stop().fadeTo("fast",0);return false});function g(){var i=f.val(),h=i.length;if(h>=e.maxChars){i=i.substring(0,e.maxChars)}if(h>e.maxChars){var j=f.scrollTop();f.val(i.substring(0,e.maxChars));f.scrollTop(j)}if(h>=e.maxCharsWarning){d.css({color:e.msgWarningColor})}else{d.css({color:e.msgFontColor})}d.html(f.val().length+"/"+e.maxChars);d.stop().fadeTo("fast",1)}})}})})(jQuery);var timeout=500;var closetimer=0;var ddmenuitem=0;function mopen(a){mcancelclosetime();if(ddmenuitem){ddmenuitem.style.visibility="hidden"}ddmenuitem=document.getElementById(a);ddmenuitem.style.visibility="visible"}function mclose(){if(ddmenuitem){ddmenuitem.style.visibility="hidden"}}function mclosetime(){closetimer=window.setTimeout(mclose,timeout)}function mcancelclosetime(){if(closetimer){window.clearTimeout(closetimer);closetimer=null}}document.onclick=mclose;