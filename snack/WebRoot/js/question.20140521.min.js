$(document).ready(function(){$("#answer").keydown(function(a){if(a.ctrlKey&&a.keyCode==13){$("#addAnswer").click()}});$("#answerComment").keydown(function(a){if(a.ctrlKey&&a.keyCode==13){$("#addAnswerComment").click()}});$("#title").keydown(function(a){if(a.ctrlKey&&a.keyCode==13){$("#addQuestion").click()}});$("#questionQuery").keydown(function(a){if(a.keyCode==13){searchQuestion()}});$("#answer").jqEasyCounter({maxChars:1000,maxCharsWarning:800,msgFontSize:"12px",msgFontColor:"#000",msgTextAlign:"left",msgWarningColor:"#F00",msgAppendMethod:"insertBefore"});$("#addQuestion").click(function(){ga("send","event","questionAnswer","AddQuestion");if($("#title").val().length<2){jQuery.noticeAdd({text:"标题长度至少2个字",stay:false});return false}$.post("/api/doAddQuestion.html",{anonymousName:$("#anonymousName").val(),title:$("#title").val(),content:$("#content").val()},function(a){if(a.search(/tooquick/i)!=-1){jQuery.noticeAdd({text:"您的动作太快，请稍事休息",stay:false});return false}else{if(a.search(/pleaselogin/i)!=-1){openLogin(window.location.href,"","")}else{if(a.search(/filter/i)!=-1){jQuery.noticeAdd({text:"不能包含敏感词汇",stay:false})}else{if(a.search(/notempty/i)!=-1){a=a.replace("notempty","");jQuery.noticeAdd({text:"已经存在相同问题",stay:false});$("#linkTitle").html($("#title").val());$("#sameTitle").attr("href","/question/"+a+"");$("#sameTitle").attr("style","display:block")}else{if(a.search(/pleasewait/i)!=-1){jQuery.noticeAdd({text:"您提交的问题等待管理员审批后通过",stay:false});$("#title").val("");$("#content").val("")}else{window.location="/question"}}}}}});return false});$("#addAnswer").click(function(){ga("send","event","questionAnswer","AddAnswer");var b=$("#sortable").children();var d=false;for(var c=1;c<5;c++){if($("#step"+c+"_img").val().length>0){d=true;break}}if($("#answer").val().length<2){if(!d){jQuery.noticeAdd({text:"内容至少2个字",stay:false});return false}}$.post("/api/doAddAnswer.html",{anonymousName:$("#anonymousName").val(),questionid:$("#questionid").val(),answer:$("#answer").val(),image1:$("#step1_img").val(),image2:$("#step2_img").val(),image3:$("#step3_img").val(),image4:$("#step4_img").val()},function(a){if(a.search(/tooquick/i)!=-1){jQuery.noticeAdd({text:"您的动作太快了，请休息一下",stay:false})}else{if(a.search(/captcha/i)!=-1){openGuestForm();return false}else{if(a.search(/filter/i)!=-1){jQuery.noticeAdd({text:"不能包含敏感词汇",stay:false})}else{if(a.search(/pleasewait/i)!=-1){jQuery.noticeAdd({text:"您的回答审批通过后显示",stay:false});$("#answer").val("");$("#sortable").hide()}else{window.location.reload()}}}}});return false});$("#samequestion").click(function(){ga("send","event","questionAnswer","SameQuestion");$.post("/api/doAddSameQuestion.html",{questionid:$("#questionid").val(),title:$("#questionTitle").val()},function(a){if(a.search(/pleaselogin/i)!=-1){openLogin(window.location.href,"","")}else{if(a.search(/repeat/i)!=-1){jQuery.noticeAdd({text:"已关注",stay:false})}else{window.location.reload()}}});return false});$("#answer").keydown(function(a){keydownGetIp()});$("#answerComment").keydown(function(a){keydownGetIp()});$("#questionQuery").autocomplete({source:"/doGetSuggestionForQuestion.html",select:function(a,b){window.location="/question/"+b.item.id}})});window.searchQuestion=function(){ga("send","event","question","questionQuery",$("#questionQuery").val());window.location.href="/questionSubmit.html?q="+encodeURI($.trim($("#questionQuery").val()));return false};window.keydownGetIp=function(){if($("#username").val()==""){if($("#anonymousName").val()==""){getIpAddr()}}};function zan(arg1){ga("send","event","questionAnswer","ZanAnswer");$.post("/api/doZanCaiAnswer.html",{questionid:$("#questionid").val(),answerid:arg1,eval:0},function(data){if(data.search(/repeat/i)!=-1){jQuery.noticeAdd({text:"已操作",stay:false})}else{var temp=$("#zan_"+arg1).text();temp=temp.replace("⬆赞(","").replace(")","");$("#zan_"+arg1).html("⬆已赞("+(parseInt(temp)+1)+")")}});return false}addComment={moveForm:function(t,s,p,u){var k=this,w,q=k.I(t),v=k.I(p),n=k.I("cancel-comment-reply-link"),o=k.I("answerid"),e=k.I("userimageComment");v.style.display="";if(!q||!v||!n||!o){return}k.respondId=p;if(!k.I("wp-temp-form-div")){w=document.createElement("div");w.id="wp-temp-form-div";w.style.display="none";v.parentNode.insertBefore(w,v)}q.parentNode.insertBefore(v,q.nextSibling);o.value=s;n.style.display="";n.onclick=function(){v.style.display="none";var c=addComment,a=c.I("wp-temp-form-div"),b=c.I(c.respondId);if(!a||!b){return}c.I("answerid").value="";a.parentNode.insertBefore(b,a);a.parentNode.removeChild(a);this.style.display="none";this.onclick=null;return false};try{k.I("answerComment").focus()}catch(r){}return false},I:function(b){return document.getElementById(b)}};window.openCommentForm=function(b,c){var a=$("#guestForm");if(a.html()==null){a=$("<div id='guestForm'  title='回答'></div>").insertAfter("#ft")}ga("send","event","questionAnswer","openCommentForm");$(a).load("/inc/guestForm.html",function(){$("#captcha").keyup(function(d){$("#guestMessage").html("&nbsp;")});$("#guestInfo").submit(function(){return false});$("#guestForm").dialog({height:330,width:330,modal:true,resizable:false,buttons:{"提交留言":function(){ga("send","event","GuestForm","doAddAnswerComment");$.post("/api/doAddAnswerComment.html",{questionid:c,answerComment:$("#answerComment").val(),captcha:$("#captcha").val(),answerid:b},function(d){if(d.search(/filter/i)!=-1){jQuery.noticeAdd({text:"不能包含敏感词汇",stay:false})}else{if(d.search(/wrongcaptcha/i)==-1){window.location.reload()}else{$("#guestMessage").html("验证码错误，请重新输入");return false}}});return false},"取消":function(){$(this).dialog("close")}}});$(this).keyup(function(d){if(d.keyCode==13){$(".ui-dialog").find("button:first").trigger("click")}})})};window.openGuestForm=function(){var a=$("#guestForm");if(a.html()==null){a=$("<div id='guestForm'  title='回答'></div>").insertAfter("#ft")}ga("send","event","questionAnswer","OpenGuestForm");$(a).load("/inc/guestForm.html",function(){$("#captcha").keyup(function(b){$("#guestMessage").html("&nbsp;")});$("#guestInfo").submit(function(){return false});$("#guestForm").dialog({height:330,width:330,modal:true,resizable:false,buttons:{"提交留言":function(){ga("send","event","GuestForm","doAddAnswer");$.post("/api/doAddAnswer.html",{questionid:$("#questionid").val(),answer:$("#answer").val(),captcha:$("#captcha").val(),image1:$("#step1_img").val(),image2:$("#step2_img").val(),image3:$("#step3_img").val(),image4:$("#step4_img").val()},function(b){if(b.search(/filter/i)!=-1){jQuery.noticeAdd({text:"不能包含敏感词汇",stay:false})}else{if(b.search(/wrongcaptcha/i)==-1){window.location.reload()}else{$("#guestMessage").html("验证码错误，请重新输入");return false}}});return false},"取消":function(){$(this).dialog("close")}}});$(this).keyup(function(b){if(b.keyCode==13){$(".ui-dialog").find("button:first").trigger("click")}})})};window.addAnswerComment=function(c,a){var b=$("#addComment");if(b.html()==null){b=$("<div id='addComment'  title='评论此答案'></div>").insertAfter("#hd")}$(b).load("/inc/answerCommentPopup.html",function(){$("#answerComment").focus();$("#addComment").dialog({height:360,width:360,modal:true,resizable:false,buttons:{"评论":function(){var d=$("#answerComment").val();if(d==""){$("#message").html("评论不能为空");return false}if($("#answerComment").val().length<2){$("#message").html("内容至少2个字");return false}$.post("/api/doAddAnswerComment.html",{anonymousName:$("anonymousName").val(),answerComment:$("#answerComment").val(),answerid:c,questionid:a},function(e){if(e.search(/tooquick/i)!=-1){jQuery.noticeAdd({text:"您的动作太快了，请休息一下",stay:false})}else{if(e.search(/captcha/i)!=-1){openCommentForm(c,a);return false}else{if(e.search(/filter/i)!=-1){jQuery.noticeAdd({text:"您的回答审批通过后显示",stay:false});$("#answerComment").val("")}else{window.location.reload()}}}})},"取消":function(){$(this).dialog("close")}}})})};